{% extends 'base.html' %}

{% block title %}Buy vs Rent Calculator - Finance Tools{% endblock %}

{% block content %}
<style>
    .winner-banner {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        margin-bottom: 30px;
        text-align: center;
    }
    .winner-banner h2 {
        margin: 0 0 10px 0;
        font-size: 32px;
    }
    .winner-banner .amount {
        font-size: 48px;
        font-weight: bold;
        margin: 10px 0;
    }
    .winner-banner .subtext {
        font-size: 18px;
        opacity: 0.9;
    }
    .chart-container-wrapper {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 30px;
    }
    .chart-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
    }
    .chart-box h3 {
        margin-top: 0;
        font-size: 18px;
        color: #333;
    }
    .chart-wrapper {
        height: 300px;
    }
    .future-comparison {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        margin: 30px 0;
    }
    .future-comparison h3 {
        margin-top: 0;
        font-size: 24px;
    }
    .future-comparison .comparison-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .future-comparison .comparison-row:last-child {
        border-bottom: none;
        font-size: 20px;
        font-weight: bold;
        padding-top: 20px;
    }
    .summary-table {
        width: 100%;
        margin: 30px 0;
        border-collapse: collapse;
        background: white;
    }
    .summary-table th,
    .summary-table td {
        padding: 15px;
        text-align: right;
        border-bottom: 1px solid #dee2e6;
    }
    .summary-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
    }
    .summary-table th:first-child,
    .summary-table td:first-child {
        text-align: left;
    }
    .summary-table .section-header {
        background: #e9ecef;
        font-weight: bold;
        color: #212529;
    }
    .summary-table .total-row {
        background: #f8f9fa;
        font-weight: bold;
        font-size: 18px;
        border-top: 3px solid #333;
    }
    .summary-table .winner {
        color: #28a745;
        font-weight: bold;
    }
    .summary-table .loser {
        color: #6c757d;
    }

    /* Mobile responsive styles */
    @media (max-width: 768px) {
        .chart-container-wrapper {
            grid-template-columns: 1fr;
        }

        .winner-banner h2 {
            font-size: 24px;
        }

        .winner-banner .amount {
            font-size: 32px;
        }

        .winner-banner .subtext {
            font-size: 16px;
        }

        .future-comparison {
            padding: 20px;
        }

        .future-comparison h3 {
            font-size: 20px;
        }

        .future-comparison .comparison-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }

        .summary-table {
            font-size: 14px;
        }

        .summary-table th,
        .summary-table td {
            padding: 10px 8px;
        }

        .chart-wrapper {
            height: 250px;
        }
    }
</style>

<h1 class="text-center mb-4">Buy vs Rent Calculator</h1>
<p class="text-center text-muted mb-4">Comparing true housing costs and wealth accumulation over your loan term</p>

<div class="alert alert-info mb-4">
    <h5>üìä How This Works</h5>
    <p class="mb-0">This calculator compares buying vs renting over your chosen loan term. For renting, you specify how much you'll invest weekly (e.g., the savings from cheaper rent) and what return you expect. This lets you explore different "what if" scenarios.</p>
</div>

<form id="buyVsRentForm">
<div class="alert alert-warning mb-4">
    <h5>‚öôÔ∏è General Settings</h5>
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="cpiRate" class="form-label fw-bold">CPI / Inflation Rate (% p.a.)</label>
                <input type="number" id="cpiRate" class="form-control form-control-lg" step="0.1" placeholder="e.g., 2.5">
                <small class="form-text text-muted">Adjusts for purchasing power over time</small>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- BUYING SCENARIO -->
    <div class="col-md-6">
        <div class="card border-primary">
            <div class="card-body">
                <h3 class="card-title text-primary">üè† Buying Scenario</h3>

                <div class="mb-3">
                    <label for="propertyPrice" class="form-label fw-bold">Property Price ($)</label>
                    <input type="number" id="propertyPrice" class="form-control form-control-lg" step="1000" placeholder="e.g., 500000">
                </div>

                <div class="mb-3">
                    <label for="loanTerm" class="form-label fw-bold">Loan Term (years)</label>
                    <input type="number" id="loanTerm" class="form-control form-control-lg" step="1" min="1" max="40" placeholder="e.g., 30">
                </div>

                <div class="mb-3">
                    <label for="interestRate" class="form-label fw-bold">Mortgage Interest Rate (%)</label>
                    <input type="number" id="interestRate" class="form-control form-control-lg" step="0.1" placeholder="e.g., 6.5">
                </div>

                <div class="mb-3">
                    <label for="councilRates" class="form-label fw-bold">Council Rates ($ per year)</label>
                    <input type="number" id="councilRates" class="form-control form-control-lg" step="100" placeholder="e.g., 2500">
                </div>

                <div class="mb-3">
                    <label for="insurance" class="form-label fw-bold">Insurance ($ per year)</label>
                    <input type="number" id="insurance" class="form-control form-control-lg" step="100" placeholder="e.g., 1500">
                </div>

                <div class="mb-3">
                    <label for="maintenance" class="form-label fw-bold">Annual Maintenance ($ per year)</label>
                    <input type="number" id="maintenance" class="form-control form-control-lg" step="100" placeholder="e.g., 2000">
                </div>

                <div class="mb-3">
                    <label for="propertyGrowth" class="form-label fw-bold">Property Growth Rate (% p.a.)</label>
                    <input type="number" id="propertyGrowth" class="form-control form-control-lg" step="0.1" placeholder="e.g., 4.0">
                </div>

                <div class="bg-light p-3 rounded">
                    <div><strong>Mortgage repayment:</strong></div>
                    <div>Monthly: <span id="monthlyMortgage">$0</span></div>
                    <div>Weekly: <span id="weeklyMortgage">$0</span></div>
                    <div class="mt-2 pt-2 border-top"><strong>Total weekly cost:</strong> <span id="buyingWeeklyCost">$0</span></div>
                    <small class="text-muted">Mortgage + rates/insurance/maintenance</small>
                </div>
            </div>
        </div>
    </div>

    <!-- RENTING SCENARIO -->
    <div class="col-md-6">
        <div class="card border-danger">
            <div class="card-body">
                <h3 class="card-title text-danger">üè¢ Renting Scenario</h3>

                <div class="mb-3">
                    <label for="weeklyRent" class="form-label fw-bold">Weekly Rent ($)</label>
                    <input type="number" id="weeklyRent" class="form-control form-control-lg" step="10" placeholder="e.g., 450">
                </div>

                <div class="mb-3">
                    <label for="rentIncrease" class="form-label fw-bold">Annual Rent Increase (%)</label>
                    <input type="number" id="rentIncrease" class="form-control form-control-lg" step="0.1" placeholder="e.g., 3.0">
                </div>

                <h5 class="mt-4 mb-3">Investment Strategy</h5>

                <div class="mb-3">
                    <label for="investmentFrequency" class="form-label fw-bold">Investment Frequency</label>
                    <select id="investmentFrequency" class="form-select form-select-lg">
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="investmentAmount" class="form-label fw-bold" id="investmentAmountLabel">Weekly Investment Amount ($)</label>
                    <input type="number" id="investmentAmount" class="form-control form-control-lg" step="10" placeholder="e.g., 100">
                </div>

                <div class="mb-3">
                    <label for="investmentIncrease" class="form-label fw-bold">Annual Investment Increase (%)</label>
                    <input type="number" id="investmentIncrease" class="form-control form-control-lg" step="0.1" placeholder="e.g., 3.0">
                </div>

                <div class="mb-3">
                    <label for="investmentReturn" class="form-label fw-bold">Investment Return (% p.a.)</label>
                    <input type="number" id="investmentReturn" class="form-control form-control-lg" step="0.1" placeholder="e.g., 7.0">
                </div>

                <div class="bg-light p-3 rounded">
                    <div><strong>Weekly rent:</strong> <span id="weeklyRentDisplay">$0</span></div>
                    <div><strong>Weekly investment:</strong> <span id="weeklyInvestmentDisplay">$0</span></div>
                    <div class="mt-2 pt-2 border-top"><strong>Total weekly cost:</strong> <span id="rentingWeeklyCost">$0</span></div>
                </div>

                <div id="investmentHelper" class="alert alert-info mt-3" style="font-size: 12px;"></div>
            </div>
        </div>
    </div>
</div>

<div class="text-center mb-4">
    <button type="button" onclick="calculate()" class="btn btn-primary btn-lg">
        <i class="bi bi-calculator"></i> Calculate
    </button>
</div>
</form>

<div class="results" id="results" style="display: none;">
    <div id="winnerBanner"></div>

    <h2>Simple Summary</h2>
    <table class="summary-table table" id="simpleSummary"></table>

    <div class="alert alert-warning">
        <h5>üí∞ CPI Adjusted Values (Real Purchasing Power)</h5>
        <p class="mb-3">These values show what your assets are REALLY worth in today's dollars after adjusting for inflation at <strong><span id="cpiRateDisplay"></span>% p.a.</strong> This is the true purchasing power.</p>
        <table class="summary-table table" id="cpiAdjustedSummary"></table>
    </div>

    <h2><span id="detailedSummaryTitle">Detailed Summary</span></h2>
    <table class="summary-table table" id="summaryTable"></table>

    <div id="futureComparison"></div>

    <div class="chart-container-wrapper">
        <div class="chart-box">
            <h3>Cumulative Spending (Cash Out)</h3>
            <div class="chart-wrapper">
                <canvas id="spendingChart"></canvas>
            </div>
        </div>
        <div class="chart-box">
            <h3>Wealth Accumulation</h3>
            <div class="chart-wrapper">
                <canvas id="wealthChart"></canvas>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-body">
            <h3>Monthly Payments Over Time</h3>
            <div style="height: 400px;">
                <canvas id="monthlyPaymentChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="mt-4">Detailed Breakdown</h2>
    <table class="summary-table table" id="detailedBreakdown"></table>

    <div id="insights"></div>
</div>
{% endblock %}

{% block scripts %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/calculators/buyvsrent.js"></script>
{% endblock %}
